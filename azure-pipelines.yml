trigger:
- main

resources:
- repo: self

pool:
  name: Default ##Substitua pelo nome do seu pool de agentes

stages:
- stage: BuildAndDeploy
  jobs:
  - job: BuildAndDeployAppMonitor
    displayName: 'Build and deploy'
    steps: 

    - task: Bash@3
      inputs:
        targetType: 'inline'
        script: |
          set -e
          
          echo "ğŸš€ Iniciando atualizaÃ§Ã£o do projeto..."
          
          cd /var/projects/App.Monitor
          git checkout master
          echo "ğŸ›  Resetando possÃ­veis mudanÃ§as locais..."

          echo "ğŸ”„ Atualizando cÃ³digo do repositÃ³rio..."
          git pull origin master || { echo "âŒ Erro ao atualizar repositÃ³rio"; exit 1; }

          echo "ğŸ›‘ Parando containers..."
          docker-compose down || echo "âš ï¸ Nenhum container rodando para parar"

          echo "ğŸš€ Subindo novos containers..."
          docker-compose up -d --build || { echo "âŒ Erro ao subir os containers"; exit 1; }

          echo "âœ… Deploy concluÃ­do com sucesso!"
